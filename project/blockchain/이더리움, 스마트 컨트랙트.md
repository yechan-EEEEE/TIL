# 이더리움(Ethereum) + 스마트 컨트랙트(Smart Contract) 개념 정리

> 목적: 프로젝트에서 “이더리움이 뭔지”와 “스마트 컨트랙트가 어떤 구조로 돌아가는지”를 빠르게 잡기 위한 노트  
> 초점: 이더리움의 구조(계정/상태/EVM), 스마트 컨트랙트 개념, Solidity, 배포/호출 흐름, 보안 포인트

---

## 1) 이더리움은 무엇인가?

이더리움(Ethereum)은 단순한 암호화폐가 아니라,  
**스마트 컨트랙트를 실행할 수 있는 분산 컴퓨터(블록체인 플랫폼)**이다.

비트코인:
- “디지털 금 + 송금”에 집중

이더리움:
- “프로그램 가능한 블록체인”  
- 누구나 스마트 컨트랙트를 배포하고 실행할 수 있음

---

## 2) 스마트 컨트랙트란?

스마트 컨트랙트(Smart Contract)는  
**블록체인 위에서 실행되는 자동 계약 코드**다.

- 계약 조건을 코드로 작성
- 조건이 충족되면 자동 실행
- 실행 결과는 블록체인에 기록(불변)

예:
- “A가 10 ETH 보내면, NFT를 자동으로 A에게 전송한다”
- “대출을 실행하고, 담보 비율이 떨어지면 자동 청산한다”

---

## 3) 이더리움의 핵심 구조: 상태 머신(State Machine)

이더리움은 단순히 거래 로그만 저장하는 게 아니라,  
**네트워크 전체가 공유하는 하나의 상태(State)를 유지하는 시스템**이다.

### 3.1 상태(State)란?
이더리움의 상태는 다음 정보를 포함한다.

- 계정들의 잔고(balance)
- 컨트랙트 코드(code)
- 컨트랙트 저장소(storage)
- nonce(재사용 공격 방지)

즉, 이더리움은  
**트랜잭션 → 실행 → 상태 변경**으로 동작한다.

---

## 4) 이더리움의 계정(Account) 구조

이더리움에는 계정이 2종류가 있다.

### 4.1 EOA(Externally Owned Account)
- 사람이 사용하는 계정(지갑)
- 개인키(private key)로 제어
- 트랜잭션을 생성할 수 있음

예:
- Metamask 주소

---

### 4.2 CA(Contract Account)
- 스마트 컨트랙트 계정
- 코드가 존재
- 스스로 트랜잭션을 시작할 수는 없음(EOA 호출이 필요)

즉,
- **EOA가 호출하면**
- 컨트랙트가 실행되고
- 상태가 바뀐다

---

## 5) EVM(Ethereum Virtual Machine)

EVM은 이더리움에서 스마트 컨트랙트를 실행하는 가상 머신이다.

### 5.1 EVM의 핵심 특징: 결정론(Deterministic)
모든 노드는 같은 트랜잭션을 실행했을 때  
**완전히 동일한 결과**를 만들어야 한다.

그래서 기본적으로:
- 랜덤(random)
- 외부 API 호출
- 현재 시간 직접 접근

같은 건 제한된다.

---

### 5.2 스마트 컨트랙트 실행 결과
트랜잭션 실행은 아래 중 하나로 끝난다.

- 성공(success): 상태 변경이 블록체인에 반영됨
- 실패(revert): 상태 변경이 모두 롤백됨(수수료는 일부 소모)

---

## 6) 가스(Gas)와 수수료 구조

이더리움은 스마트 컨트랙트 실행에 비용을 부과한다.

### 6.1 왜 가스가 필요한가?
- 무한 루프 같은 악성 코드 방지
- 네트워크 자원 보호
- 스팸 트랜잭션 억제

---

### 6.2 수수료 공식(개념)
- **transaction fee = gas_used × gas_price**

gas_used:
- 실제로 실행된 연산량

gas_price:
- 사용자가 지불할 단가

---

## 7) Solidity(솔리디티)란?

Solidity는 이더리움 스마트 컨트랙트를 작성하는 대표 언어다.

특징:
- 문법이 JavaScript / C 계열과 유사
- 컴파일하면 EVM 바이트코드(bytecode)가 됨
- 배포하면 컨트랙트 주소(contract address)가 생성됨

---

## 8) 스마트 컨트랙트의 기본 구성

Solidity 컨트랙트는 보통 다음 요소로 구성된다.

### 8.1 상태 변수(State Variables)
컨트랙트 내부에 저장되는 값.
블록체인의 storage에 기록됨.

예:
- balances[address]
- owner

---

### 8.2 함수(Function)
외부에서 호출 가능한 로직.

- public/external: 외부 호출 가능
- internal/private: 내부 호출만 가능

---

### 8.3 이벤트(Event)
블록체인에 로그를 남기는 구조.

중요:
- 이벤트는 “상태 저장”이 아니라 “로그”다.
- 프론트엔드가 컨트랙트 상태 변화를 추적할 때 매우 유용

---

### 8.4 Modifier
함수 실행 조건을 간단히 붙이는 기능.

예:
- onlyOwner
- onlyAdmin

---

## 9) 스마트 컨트랙트의 동작 흐름(배포~사용)

### 9.1 배포(Deploy)
1. 개발자가 Solidity 코드를 작성
2. 컴파일 → bytecode 생성
3. 배포 트랜잭션을 전송
4. 블록에 포함되면 컨트랙트가 생성됨
5. 컨트랙트 주소가 발급됨

---

### 9.2 호출(Call)
사용자는 다음 방식으로 컨트랙트를 사용한다.

#### (1) 읽기 호출(View / Pure)
- 상태를 바꾸지 않음
- 가스 비용 없음(노드 RPC에서 조회)

예:
- getBalance()

#### (2) 쓰기 호출(Transaction)
- 상태 변경 발생
- 가스 비용 발생
- 블록에 포함되어야 최종 반영됨

예:
- transfer()
- mint()

---

## 10) 토큰과 스마트 컨트랙트

이더리움에서 토큰은 “코인이 아니라 컨트랙트”다.

### 10.1 ERC-20 (Fungible Token)
- 교환 가능한 토큰(동일 가치)
- 예: USDT, UNI 등

핵심 함수:
- transfer()
- approve()
- transferFrom()

---

### 10.2 ERC-721 (NFT)
- 대체 불가능 토큰
- 예: NFT 이미지, 티켓, 멤버십

---

### 10.3 ERC-1155 (멀티 토큰)
- FT + NFT를 하나의 컨트랙트에서 관리 가능

---

## 11) 오라클(Oracle): 현실 데이터를 블록체인으로

스마트 컨트랙트는 외부 API를 직접 호출할 수 없다.

그래서 외부 데이터를 넣기 위해
**오라클(Oracle)** 이 필요하다.

예:
- ETH/USD 가격
- 날씨 데이터
- 스포츠 경기 결과

대표:
- Chainlink

주의:
- 오라클은 공격 포인트가 될 수 있음(조작 가능성)

---

## 12) 스마트 컨트랙트 보안 핵심 이슈

스마트 컨트랙트는 배포하면 수정이 어렵고,  
코드가 곧 돈이 된다.

그래서 보안이 매우 중요하다.

### 12.1 대표 취약점

#### (1) Reentrancy(재진입 공격)
- 외부 호출을 잘못 처리하면
- 공격자가 반복 호출로 자금을 빼갈 수 있음

#### (2) Integer Overflow/Underflow
- 예전 Solidity에서 흔했음
- 최신 버전은 기본적으로 방지

#### (3) Access Control 문제
- onlyOwner 같은 권한 체크 누락

#### (4) Front-running / MEV
- 거래가 공개 mempool에 노출되므로
- 누군가 먼저 거래를 끼워넣을 수 있음

---

### 12.2 보안 대응 방식
- 컨트랙트 감사(Audit)
- 테스트(단위/통합)
- 정적 분석 도구 사용
- 업그레이드 가능한 구조(Proxy) 사용(단, 복잡도 증가)

---

## 13) 업그레이드(Upgrade) 문제

스마트 컨트랙트는 보통 한 번 배포하면 수정이 어렵다.

그래서 실무에서는 종종
**프록시(Proxy) 패턴**을 사용한다.

- 주소는 유지
- 구현 로직만 교체 가능

하지만 단점:
- 설계가 복잡해짐
- 보안 취약점이 늘어날 수 있음

---

## 14) 이더리움 개발 흐름(실전 관점)

개발자가 실제로 하는 작업은 보통 이렇다.

1. Solidity로 컨트랙트 작성
2. Hardhat/Foundry로 테스트
3. 로컬 네트워크에서 실행(Ganache, Hardhat node)
4. 테스트넷 배포(Sepolia 등)
5. 메인넷 배포(필요 시)
6. 프론트엔드(Web3.js, Ethers.js)로 연결

---

## 15) 한 줄 요약

- 이더리움은 “스마트 컨트랙트를 실행하는 분산 컴퓨터”다.  
- 스마트 컨트랙트는 “블록체인 위에서 실행되는 자동 계약 코드”다.  
- 핵심 구조는 **계정(EOA/CA) + 상태(State) + EVM 실행 + 가스**이며,  
  실무 이슈는 **보안(취약점) + 업그레이드 + 오라클**이다.
