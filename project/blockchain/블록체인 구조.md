# 블록체인 구조(Architecture) 정리 노트

> 목적: 블록체인을 “기술 구조 관점”에서 이해하기 위한 MD 노트  
> 초점: 데이터 구조(블록/체인), 네트워크 구조(노드), 합의 구조, 실행 구조(스마트 컨트랙트), 확장 구조(L2)

---

## 1) 블록체인 구조를 한 문장으로

블록체인은 **(1) 거래 데이터를 블록에 담고**,  
그 블록을 **(2) 암호학적으로 연결한 뒤**,  
**(3) 분산 네트워크가 합의 알고리즘으로 승인하여**,  
**(4) 모든 노드가 동일한 원장을 공유**하도록 만든 시스템이다.

---

## 2) 블록체인의 계층 구조(레이어 관점)

블록체인은 보통 아래처럼 레이어로 나누어 이해한다.

### 2.1 데이터 레이어(Data Layer)
- 블록(Block) 구조
- 체인(Chain) 구조
- 해시(Hash) 및 머클 트리(Merkle Tree)

### 2.2 네트워크 레이어(Network Layer)
- P2P 네트워크
- 노드 간 블록/거래 전파(gossip)

### 2.3 합의 레이어(Consensus Layer)
- PoW / PoS 등
- 블록 생성자 선정, 최종성(finality)

### 2.4 실행 레이어(Execution Layer)
- 스마트 컨트랙트 실행(EVM 등)
- 트랜잭션 실행, 상태(state) 변경

### 2.5 응용 레이어(Application Layer)
- 지갑(Wallet)
- DApp, DeFi, NFT, DAO 등

---

## 3) 블록체인의 핵심 데이터 구조

### 3.1 트랜잭션(Transaction)
블록체인에서의 “트랜잭션”은 단순한 송금뿐 아니라 다음을 포함한다.

- 코인 송금(transfer)
- 토큰 송금(ERC-20 transfer)
- 스마트 컨트랙트 함수 호출(contract call)
- NFT 민팅/전송

트랜잭션의 핵심 구성:
- sender(보내는 주소)
- receiver(받는 주소 또는 컨트랙트 주소)
- value(송금액)
- data(스마트 컨트랙트 호출 정보)
- signature(전자서명)

---

### 3.2 블록(Block) 구조

블록은 크게 **헤더(Header)** + **바디(Body)** 로 나뉜다.

#### (1) 블록 헤더(Block Header)
대표적으로 포함되는 정보:
- **previous_block_hash**: 이전 블록 해시 (체인 연결 핵심)
- **merkle_root**: 블록 내 트랜잭션들의 요약값
- **timestamp**: 블록 생성 시각
- **difficulty / validator 정보**: 합의 방식에 따라 다름
- **nonce**: PoW에서 채굴 퍼즐 해결용 값

#### (2) 블록 바디(Block Body)
- 실제 트랜잭션 목록
- (체인마다 다르지만) 스마트 컨트랙트 실행 결과 요약 포함 가능

---

### 3.3 체인(Chain) 구조

블록체인은 단순히 “블록이 줄줄이 이어진 것”이 아니라,
다음 2가지 의미를 가진다.

- **구조적 연결**: 이전 블록 해시를 포함해서 연결
- **신뢰 연결**: 이전 기록을 바꾸면 이후 블록 전체가 깨짐

즉, 데이터 변조를 사실상 불가능하게 만드는 핵심 구조이다.

---

### 3.4 머클 트리(Merkle Tree)

블록 안에 트랜잭션이 많아도,
트랜잭션 전체를 다 저장하지 않고도 검증할 수 있게 해주는 구조.

- 트랜잭션들을 해시로 만들고
- 해시들을 2개씩 묶어서 다시 해시
- 최종적으로 하나의 루트 해시(Merkle Root) 생성

장점:
- 특정 트랜잭션이 블록에 포함됐는지 빠르게 증명 가능
- 라이트 노드(SPV) 구현에 핵심

---

## 4) 네트워크 구조(P2P 네트워크)

블록체인은 중앙 서버가 아니라,
노드들이 직접 연결된 **P2P 네트워크** 위에서 동작한다.

### 4.1 노드(Node)란?
블록체인 네트워크에 참여하는 컴퓨터(서버).

노드가 하는 일:
- 트랜잭션 검증
- 블록 검증
- 블록 저장
- 다른 노드에 블록/거래 전파

---

### 4.2 노드 종류

#### (1) 풀 노드(Full Node)
- 모든 블록 데이터를 저장
- 모든 거래를 검증
- 보안성과 신뢰성의 핵심

#### (2) 라이트 노드(Light Node)
- 모든 블록을 저장하지 않음
- 머클 증명(SPV)을 통해 최소한의 검증만 수행
- 모바일 지갑이 주로 해당

#### (3) 마이너/밸리데이터(Miner/Validator)
- PoW: 마이너가 블록 생성
- PoS: 밸리데이터가 블록 생성 및 검증

---

## 5) 합의 구조(Consensus Architecture)

블록체인은 “모두가 같은 원장을 갖도록” 합의가 필요하다.

### 5.1 PoW(작업증명) 구조
- 채굴자들이 해시 퍼즐을 먼저 푼 사람이 블록 생성
- 난이도(difficulty)를 조절하여 블록 생성 속도를 일정하게 유지

장점:
- 매우 강력한 보안성(공격 비용 높음)

단점:
- 전력 소모 큼
- TPS 낮음
- 채굴 중앙화 위험(대형 채굴장)

---

### 5.2 PoS(지분증명) 구조
- 코인을 예치(스테이킹)한 밸리데이터가 블록 생성/검증
- 예치금이 담보 역할 → 악의적 행동 시 슬래싱(slash)

장점:
- 전력 효율 좋음
- 속도 및 확장성 개선 가능

단점:
- 부의 집중이 지배력으로 이어질 수 있음

---

### 5.3 최종성(Finality)
블록체인에서는 “이 거래가 진짜 확정인가?”가 중요하다.

- **확률적 최종성**: (PoW 계열) 시간이 지나 블록이 쌓일수록 확정에 가까워짐
- **즉시 최종성**: (일부 PoS/BFT 계열) 특정 조건 충족 시 확정

---

## 6) 실행 구조(Execution Architecture)

### 6.1 상태(State) 기반 구조
특히 이더리움 계열은 “계정 상태”를 유지한다.

상태에는 보통 다음이 포함된다.
- 계정 잔고(balance)
- 컨트랙트 코드(code)
- 스토리지(storage)
- nonce(재사용 공격 방지)

즉, 블록체인은 단순히 로그가 아니라
**상태 머신(State Machine)** 이다.

---

### 6.2 EVM(Ethereum Virtual Machine)
- 이더리움에서 스마트 컨트랙트를 실행하는 가상 머신
- 모든 노드가 동일한 실행 결과를 만들어야 함(결정론적 실행)

결정론적 실행이란?
- 같은 입력이면 항상 같은 결과
- 랜덤, 외부 API 호출 같은 것은 기본적으로 금지

---

### 6.3 가스(Gas) 구조
스마트 컨트랙트는 실행 비용이 발생한다.

- 가스는 “연산 비용”을 의미
- 무한 루프, 과도한 연산을 막기 위한 경제적 장치
- 트랜잭션 수수료 = gas_used × gas_price

---

## 7) 블록체인의 확장 구조(Scalability Architecture)

블록체인의 대표적인 문제는 확장성(TPS)이다.

### 7.1 온체인 확장
- 블록 크기 증가
- 블록 생성 속도 증가
- 샤딩(sharding)

하지만 온체인 확장은 보통
- 저장 부담 증가
- 중앙화 위험 증가
라는 트레이드오프가 있다.

---

### 7.2 오프체인 확장(Layer 2)
대표적으로 롤업(Rollup)이 있다.

#### (1) Optimistic Rollup
- “일단 믿고” 처리
- 나중에 문제가 있으면 증명으로 롤백 가능

#### (2) ZK Rollup
- 거래 묶음을 처리하고
- 그 결과가 맞다는 “영지식 증명(ZK proof)”을 제출

장점:
- 빠르고 수수료 낮음
- 메인 체인의 보안성 활용

---

### 7.3 브릿지(Bridge)
체인과 체인 사이 자산 이동을 가능하게 하는 구조.

주의:
- 브릿지는 해킹 타겟 1순위
- 보안 설계가 매우 중요

---

## 8) 전체 구조를 한 번에 보는 그림(텍스트 버전)

사용자(지갑)
   ↓ 트랜잭션 생성 + 서명
P2P 네트워크 전파
   ↓
노드들이 검증
   ↓
합의 알고리즘으로 블록 생성자 선정
   ↓
블록 생성(헤더 + 트랜잭션)
   ↓
블록체인에 연결(previous hash)
   ↓
모든 노드가 블록 저장 + 상태 업데이트
   ↓
DApp 결과 반영(잔고 변경, 컨트랙트 실행 등)

---

## 9) 프로젝트 개발 관점 체크리스트

### 9.1 “왜 블록체인을 쓰는가?”를 구조적으로 설명 가능해야 함
- 여러 주체가 참여하는 시스템인가?
- 기록 조작 방지가 핵심인가?
- 중앙기관이 신뢰를 제공하기 어려운가?

### 9.2 보안 설계
- 키 관리(지갑, 개인키, 서명)
- 컨트랙트 감사/테스트
- 브릿지/오라클 사용 시 리스크

### 9.3 성능 설계
- 온체인에 올릴 데이터 최소화
- L2 사용 고려
- 이벤트 로그(event) 활용

---

## 10) 한 줄 요약

블록체인 구조는  
**(데이터 구조: 블록+체인+머클)** + **(네트워크: P2P+노드)** +  
**(합의: PoW/PoS)** + **(실행: 상태머신+스마트컨트랙트)** +  
**(확장: L2/롤업)** 으로 이해하면 된다.
