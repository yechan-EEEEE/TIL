# 블록체인 보안 정리: 키 관리(지갑) + 스마트 컨트랙트 취약점

> 목적: 블록체인 프로젝트에서 “해킹이 왜 이렇게 많이 나는지”를 구조적으로 이해하고,  
> 실전에서 반드시 알아야 하는 **키 관리**와 **컨트랙트 취약점**을 정리한 노트

---

## 0) 가장 중요한 전제

블록체인 보안은 단순히 “코드가 안전한가?”가 아니다.

> 블록체인 보안 = **키(자산 접근 권한) 보안** + **컨트랙트 코드 보안** + **운영 보안(DevOps)**

특히 실제 사고는  
- 컨트랙트 버그보다  
- **키 탈취(피싱/지갑) + 운영 실수**에서 더 많이 터진다.

---

## 1) 키 관리(Key Management)란?

### 1.1 개인키(Private Key)가 곧 자산이다
블록체인에서 자산 소유권은 “계정”이 아니라
**개인키를 누가 가지고 있느냐**로 결정된다.

즉:
- 개인키를 잃으면 → 자산 복구 불가능
- 개인키가 털리면 → 자산이 바로 탈취됨
- 중앙기관이 되돌려주지 못함

---

### 1.2 키와 주소의 관계(개념)
- 개인키(private key) → 공개키(public key) → 주소(address)

주소는 공개되지만,  
개인키는 절대 노출되면 안 된다.

---

## 2) 지갑(Wallet)의 구조

### 2.1 지갑은 “코인을 저장하는 앱”이 아니다
지갑은 실제로 코인을 저장하지 않는다.

지갑이 하는 일:
- 개인키를 안전하게 저장
- 트랜잭션에 서명(sign)
- 네트워크에 전송

코인은 블록체인 상태(state)에 존재한다.

---

### 2.2 핫월렛(Hot Wallet) vs 콜드월렛(Cold Wallet)

#### 핫월렛
- 인터넷 연결 환경에서 키를 관리
- 예: Metamask, 모바일 지갑

장점:
- 편리함

단점:
- 피싱/악성코드/브라우저 공격에 취약

---

#### 콜드월렛
- 오프라인/하드웨어에서 키를 관리
- 예: Ledger, Trezor

장점:
- 공격 표면이 작음
- 해킹 난이도 증가

단점:
- 사용 불편
- 분실 위험

---

## 3) 시드 문구(Seed Phrase) / 니모닉

대부분의 지갑은
**12~24 단어**로 구성된 시드 문구를 제공한다.

이 시드 문구는 사실상:
- 지갑의 “마스터 키”
- 모든 계정을 복구할 수 있는 열쇠

주의:
- 시드 문구가 유출되면 끝
- 클라우드/메모앱 저장은 매우 위험
- 사진 촬영도 위험(클라우드 자동 백업)

---

## 4) 멀티시그(Multi-Sig)와 기업 운영

### 4.1 멀티시그란?
자산 이동에 1명이 아니라
여러 명의 서명이 필요하도록 만드는 방식.

예:
- 3명 중 2명 서명 필요(2-of-3)

---

### 4.2 왜 중요한가?
- 한 명의 키가 털려도 즉시 탈취 불가
- 내부자 사고(횡령) 방지
- 기업/DAO 자산 관리의 기본

대표 솔루션:
- Gnosis Safe

---

## 5) 키 관리에서 자주 터지는 사고 유형

### 5.1 피싱(Phishing)
- “지갑 연결하세요”
- “에어드랍 받으세요”
- “승인(approve) 눌러주세요”

→ 승인 후 토큰이 털리는 경우가 매우 많다.

---

### 5.2 악성 확장 프로그램 / 악성코드
- 브라우저 확장 프로그램이 클립보드를 조작하거나
- 지갑 서명 요청을 바꿔치기하는 방식

---

### 5.3 승인(Approval) 악용
ERC-20:
- approve 무한 승인 → 이후 transferFrom으로 탈취 가능

ERC-721:
- setApprovalForAll → 모든 NFT를 빼갈 수 있음

---

### 5.4 키 백업 실패
- 하드웨어 지갑 분실
- 시드 문구 분실
- 2차 백업 없음

→ 복구 불가능

---

## 6) 스마트 컨트랙트 보안 개요

### 6.1 스마트 컨트랙트는 왜 위험한가?
- 배포 후 수정이 어렵다(불변성)
- 코드가 곧 돈이다
- 버그가 나면 공격자가 즉시 악용한다
- 공격자는 전 세계 어디서든 자동으로 공격 가능

즉,
**웹 서비스보다 훨씬 더 공격 친화적인 환경**이다.

---

### 6.2 공격자 관점
공격자는 다음을 노린다.

- 컨트랙트가 보유한 자산 탈취
- 사용자 토큰 승인(approve)을 이용한 탈취
- 가격 조작(오라클)
- MEV로 거래 순서 조작

---

## 7) 대표 스마트 컨트랙트 취약점 Top 10

### 7.1 Reentrancy(재진입 공격)
가장 유명한 취약점 중 하나.

#### 개념
컨트랙트가 외부 주소로 ETH를 보내는 순간,
상대 컨트랙트가 다시 호출해 반복 탈취하는 공격.

#### 대표 사례
- The DAO 해킹(2016)

#### 방어
- Checks-Effects-Interactions 패턴
- ReentrancyGuard 사용
- pull payment 방식

---

### 7.2 Access Control(권한 관리) 오류
- onlyOwner 체크 누락
- 관리자 함수가 누구나 호출 가능

#### 방어
- 역할 기반 접근 제어(RBAC)
- OpenZeppelin AccessControl 사용

---

### 7.3 Integer Overflow/Underflow
예전 Solidity에서는 숫자가 범위를 넘으면
값이 돌아가면서 치명적 버그 발생.

- 최신 Solidity는 기본적으로 overflow 체크

---

### 7.4 Front-running / MEV
블록체인에서는 거래가 mempool에 공개된다.

공격자는:
- 사용자 거래를 보고
- 더 높은 수수료로 먼저 실행시키거나
- 거래 사이에 끼워넣을 수 있다

대표 형태:
- sandwich attack(샌드위치 공격)

방어:
- commit-reveal
- private mempool
- slippage 제한

---

### 7.5 Price Oracle Manipulation(오라클 조작)
DeFi 컨트랙트가 가격을 참조할 때,
가격이 조작되면 청산/스왑이 악용될 수 있다.

방어:
- Chainlink 같은 신뢰 오라클 사용
- TWAP(시간 가중 평균 가격)
- 다중 소스 가격

---

### 7.6 Flash Loan Attack(플래시 론 공격)
플래시 론은 담보 없이 한 블록 안에서 빌렸다가 갚는 대출.

공격자는:
- 순간적으로 큰 자금을 빌려
- 가격 조작 + 청산 + 이익 실현을 한 블록에서 끝낸다.

방어:
- 오라클 조작 방어가 핵심
- 상태 변화에 지연(시간 기반) 추가

---

### 7.7 Denial of Service(DoS)
특정 주소가 revert를 유발하거나,
가스 소모를 과도하게 만들어 함수 실행을 막는 공격.

방어:
- 반복문 최소화
- push 대신 pull 방식
- 실패에 안전한 로직

---

### 7.8 Unchecked External Call
외부 컨트랙트 호출이 실패했는데도
결과를 확인하지 않고 진행하면 논리 오류 발생.

방어:
- return 값 확인
- try/catch 사용

---

### 7.9 Signature Replay / Nonce 문제
서명 기반 실행에서 nonce가 제대로 관리되지 않으면,
서명을 재사용해서 반복 실행 가능.

방어:
- nonce 저장
- EIP-712 표준 서명 사용

---

### 7.10 업그레이드(Proxy) 취약점
프록시 패턴은 유연하지만,
설계 실수 시 치명적이다.

- 구현 주소 바꿔치기
- 초기화 함수 재호출
- storage slot 충돌

방어:
- OpenZeppelin UUPS/Transparent Proxy 사용
- initializer 보호
- 감사 필수

---

## 8) 스마트 컨트랙트 개발 시 보안 체크리스트

### 8.1 설계 단계
- 자산이 어디에 저장되는가?
- 누가 어떤 권한을 가지는가?
- 오라클/브릿지 같은 외부 의존성이 있는가?
- 실패 시 롤백이 가능한가?

---

### 8.2 구현 단계
- OpenZeppelin 라이브러리 적극 활용
- require/assert 메시지 명확히
- 상태 변경 후 외부 호출 금지(CEI 패턴)

---

### 8.3 테스트 단계
- 단위 테스트(Unit Test)
- 시나리오 테스트(Integration)
- 퍼징(Fuzzing)
- 포멀 검증(Formal Verification) (고급)

---

### 8.4 배포 단계
- 테스트넷에서 충분히 검증
- 멀티시그로 관리자 권한 관리
- 업그레이드 계획 명확히

---

## 9) 실전에서 많이 쓰는 보안 도구/라이브러리

### 9.1 OpenZeppelin
- ERC-20, ERC-721 구현 표준
- AccessControl, Ownable
- ReentrancyGuard 등

---

### 9.2 정적 분석 도구
- Slither
- Mythril

---

### 9.3 테스트/프레임워크
- Hardhat
- Foundry

---

## 10) 프로젝트 발표에서 먹히는 핵심 메시지

블록체인 보안은 보통 다음 2개로 정리된다.

### 10.1 키 보안
- 개인키 = 자산
- 피싱/승인 공격이 실제 피해의 핵심

### 10.2 컨트랙트 보안
- 버그는 즉시 돈으로 연결됨
- 표준 라이브러리 + 테스트 + 감사가 필수

---

## 11) 한 줄 요약

- 블록체인에서 가장 중요한 보안은 **개인키 관리**다.  
- 스마트 컨트랙트는 “코드가 곧 돈”이기 때문에  
  작은 버그도 바로 공격으로 이어진다.  
- 실전에서는 **피싱/승인 악용 + 컨트랙트 취약점 + 운영 실수**가 가장 큰 리스크다.
