# 합의 알고리즘(Consensus) 정리: PoW vs PoS

> 목적: 블록체인에서 합의(Consensus)가 왜 필요한지, 그리고 대표 합의 방식인 **PoW / PoS**를 구조적으로 이해하기 위한 노트

---

## 1) 합의(Consensus)란 무엇인가?

블록체인은 중앙 서버가 없기 때문에, 네트워크 참여자들이 다음 질문에 합의해야 한다.

- **“어떤 거래가 진짜인가?”**
- **“어떤 블록이 다음 블록인가?”**
- **“블록체인의 최신 상태는 무엇인가?”**

즉, 합의 알고리즘은  
**분산 네트워크에서 ‘하나의 정답 원장’을 만드는 규칙**이다.

---

## 2) 합의가 필요한 이유

### 2.1 이중 지불(Double Spending) 문제
같은 돈을 두 번 쓰려는 공격이 가능하다.

예:
- A가 B에게 10코인을 보내는 거래
- 동시에 A가 C에게 10코인을 보내는 거래

중앙은행이 없다면, 둘 중 어느 거래가 유효한지 결정해야 한다.

---

### 2.2 분산 시스템의 본질적 문제
- 네트워크 지연(latency)
- 일부 노드의 고장/악의적 행동
- 서로 다른 노드가 다른 정보를 받을 수 있음

→ 합의는 이런 환경에서도 “정답을 하나로 맞추는 장치”다.

---

## 3) PoW(Proof of Work, 작업증명)

### 3.1 핵심 아이디어
**컴퓨팅 연산(작업)을 먼저 증명한 사람이 블록을 만들 수 있다.**

즉, 블록 생성 권한을 “연산 경쟁”으로 결정한다.

대표 네트워크:
- Bitcoin

---

### 3.2 PoW의 동작 구조(흐름)

1. 네트워크에 트랜잭션이 모인다
2. 마이너(miner)가 트랜잭션을 모아 블록 후보를 만든다
3. 마이너는 블록 헤더에 nonce를 바꿔가며 해시를 반복 계산한다
4. 특정 조건(난이도)을 만족하는 해시를 먼저 찾은 마이너가 승리
5. 승리한 블록이 네트워크에 전파되고, 다른 노드들이 검증 후 채택한다
6. 블록이 체인에 연결된다

---

### 3.3 난이도(Difficulty)
PoW는 블록 생성 속도를 일정하게 유지하기 위해 난이도를 조절한다.

- 네트워크 채굴 파워가 커지면 난이도 증가
- 채굴 파워가 줄면 난이도 감소

---

### 3.4 보상 구조
마이너는 블록을 생성하면 다음을 받는다.

- 블록 보상(block reward, 신규 발행 코인)
- 트랜잭션 수수료(transaction fee)

---

### 3.5 PoW의 장점
- **보안성이 매우 강함**
- 공격자가 네트워크를 장악하려면 엄청난 연산 자원이 필요
- 오랜 시간 검증된 방식(비트코인)

---

### 3.6 PoW의 단점
- **전력 소비가 매우 큼**
- 처리 속도(TPS)가 낮음
- 채굴 장비(ASIC)로 인한 중앙화 가능성
- 블록 확정이 느림(확률적 최종성)

---

### 3.7 PoW에서 자주 나오는 개념

#### 51% 공격
공격자가 전체 해시 파워의 51% 이상을 장악하면,
블록을 재작성하거나 특정 거래를 무효화할 가능성이 생김.

#### 확률적 최종성(Probabilistic Finality)
PoW에서는 블록이 쌓일수록 확정성이 높아진다.

- 1개 블록만 쌓이면 되돌릴 가능성이 존재
- 6개 이상 쌓이면 사실상 확정으로 간주(비트코인 관행)

---

## 4) PoS(Proof of Stake, 지분증명)

### 4.1 핵심 아이디어
**코인을 예치(스테이킹)한 사람에게 블록 생성 권한을 준다.**

즉, 블록 생성 권한을 “지분(Stake)”으로 결정한다.

대표 네트워크:
- Ethereum (PoW → PoS 전환 완료)
- Solana, Avalanche 등

---

### 4.2 PoS의 동작 구조(흐름)

1. 참여자는 일정량의 코인을 스테이킹(예치)한다
2. 네트워크는 밸리데이터(validator)를 선정한다
3. 선정된 밸리데이터가 블록을 제안(propose)한다
4. 다른 밸리데이터들이 블록을 검증하고 서명(attest)한다
5. 일정 기준을 충족하면 블록이 확정된다
6. 정직한 밸리데이터는 보상을 받고, 악의적이면 패널티를 받는다

---

### 4.3 슬래싱(Slashing)
PoS의 핵심 보안 장치.

- 악의적으로 행동하거나
- 동일한 높이(height)에 두 블록을 서명하거나
- 검증 규칙을 위반하면

스테이킹한 코인을 일부/전부 잃는다.

→ 공격 비용이 “전기료”가 아니라 “담보”로 바뀐다.

---

### 4.4 PoS의 장점
- **전력 소비가 매우 낮음**
- 확장성(TPS) 개선 가능
- 확정(finality)이 빠를 수 있음
- 채굴 장비가 필요 없어 진입 장벽이 낮음

---

### 4.5 PoS의 단점
- **부의 집중이 곧 네트워크 지배력으로 이어질 수 있음**
- 스테이킹 풀/거래소에 지분이 집중될 가능성
- 복잡한 설계(프로토콜 난이도 높음)
- 장기 공격(Long-range attack) 같은 새로운 공격 벡터 존재

---

## 5) PoW vs PoS 비교 표

| 항목 | PoW | PoS |
|------|-----|-----|
| 블록 생성 권한 | 연산 경쟁 | 지분(스테이킹) |
| 대표 체인 | Bitcoin | Ethereum, Solana |
| 에너지 소비 | 매우 높음 | 낮음 |
| 보안 비용 | 전기 + 장비 | 담보(스테이킹) |
| 최종성 | 확률적 | 빠른 최종성 가능 |
| 중앙화 리스크 | 채굴장/ASIC | 거래소/스테이킹 풀 |
| TPS/확장성 | 낮음 | 상대적으로 높음 |
| 설계 난이도 | 단순 | 복잡 |

---

## 6) 프로젝트에서 중요한 관점

### 6.1 “합의는 곧 신뢰의 비용”이다
PoW:
- 신뢰 비용 = 전기료 + 연산

PoS:
- 신뢰 비용 = 예치금(담보)

즉, 합의 알고리즘은 단순한 기술 선택이 아니라
**“신뢰를 어떤 방식으로 구매할 것인가?”**의 선택이다.

---

### 6.2 퍼블릭 vs 프라이빗에서 합의의 의미가 달라진다
- 퍼블릭 체인: 공격자가 존재한다고 가정 → 강한 합의 필요
- 프라이빗 체인: 참여자가 제한됨 → 더 빠른 합의(BFT 등) 가능

즉, 프로젝트가 “어떤 형태의 블록체인”인지에 따라
합의 알고리즘 선택이 달라진다.

---

## 7) PoW/PoS 외에 알아두면 좋은 합의 방식(확장)

### 7.1 BFT 계열(PBFT, Tendermint 등)
- 빠른 확정성
- 참여자가 제한된 환경(컨소시엄/프라이빗)에 적합

### 7.2 DPoS(Delegated PoS)
- 투표로 대표자를 뽑아 블록 생성
- 속도는 빠르지만 중앙화 논쟁이 있음

---

## 8) 한 줄 요약

- **PoW**는 “연산을 통해 신뢰를 만든다”  
- **PoS**는 “담보(스테이킹)를 통해 신뢰를 만든다”  
- 최근 블록체인 산업은 전력/확장성 문제 때문에 PoS 중심으로 이동했지만,  
  **보안·중앙화·거버넌스 문제는 여전히 핵심 이슈**다.
